local level = {}
--[[关卡结构,每一关有有2个表:stroy和monster,其中stroy中是所有剧情,stroycon是每对话一次都会调用的函数来判断玩家是否可以进行下一步对话]]
--[[monster是Monter的属性表和技能名，和AI状态机函数【如果lua语法错load则会提示lua:37: attempt to call a nil value】]]
--[[exp是通过该关卡获得的经验]]

local function commonthink(academy_t)
	local self = academy_t
	local monster = self.monster
	local role = self.role
	local skill_num = #monster.skill
	local skill_index
	repeat
		skill_index = math.random(skill_num)
	until not (monster.skill[skill_index].passive)
	monster:castskill(monster.skill[skill_index].name,role)
	--monster:castskill(monster.skill[math.random(skill_num)].name,role)
end

function commonrule(academy_t)
	local self = academy_t
	local monster = self.monster
	local role = self.role
	if self.role.law <1 then
		return false
	end
	return true
end

--第一关校外打流氓(混混喜欢秩序低于-50友好>10的角色)
local outschool ={}
level[1] = outschool
outschool.name = "不期而遇的麻烦!"
outschool.story = {
	[1] = {"嘿!?那边那个你在干吗呢?嘿嘿!",{"我……",0,1},{"不关你事吧!",1,-1}},
	[2] = {"嘿嘿!学园都市的学生是吗?",{"额……不是……",3,0},{"(无视他……)",-3,-3}},
	[3] = {"soga……觉得你蛮有趣呢!",{"够了吧，我不想再和你说话。",5,-2},{"真是无聊，你要干什么呢？",-5,2}},
	[4] = {"你刚才干嘛了？我好像听到了警报声啊！",{"那一定是你听错了，我可没听到什么声音！",-5,0}},
	[5] = {"是吗？不会是你干了什么坏事吧？！",{"坏事是只有你这种人才会干的吧！",3,-2},{"人格测试那种东西坏掉才好呢！",-3,2}},
	before = "\27[37m(这是你第一次进入学院都市，并且一时冲动弄坏了人格测试机，虽然是收到学院都市栅川中学的入学邀请，但对于自己这样莽撞的行为心里还是很慌……)\27[0m\n",
	pass = "诶！那种东西早该坏掉了！！就是因为它我才被大家当成了混混！/(ㄒoㄒ)/~~",
	fight = "看来跟你讲\"道理\"是很难的一件事呢！",
	}
outschool.story.func=function (academy_t)
	-- 这个函数能获取当前academy_t的所有域值
	local self = academy_t
	local monster = self.monster
	local role = self.role
	if self.role.law < -50 and self.role.good >10 then 
		return true
	end 
	return false
end
--{level=0,exp=0,hp=200,mp=50,natt=20,ndef=0,sdef=0,bpos=0,bspd=0,accu=0,miss=0,crit=0,skill={},buffround={},name ="name",law=0,good=0}
outschool.monster = {name="街头混混",_skill={"强力击","操纵火焰"},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
outschool.monster.think = commonthink
outschool.exp = 6
outschool.loot = {{10000,"强力击"},{10000,"操纵火焰"}}  --掉落之类的，可能目前只会从monster._skill表中掉技能。。

--第二关 遇见佐天泪子，与之对话，纠正世界观。（佐天泪子会和你说完所有的对话）
local inschool = {}
level[2] = inschool
inschool.name = "素不相识的伙伴!"
inschool.story = {
	[1] = {"\'栅川中学入学指南\'？……新生？哇！一年级的新生？",{"……",0,0}},
	[2] = {"那个？你是栅川一年级的新生吗？",{"先辈？",3,3}},
	[3] = {"先辈！？好…好…厉害！！你是今天才来学院都市吗？",{"是啊，第一天来就遇到了麻烦事",0,2}},
	[4] = {"诶！？麻烦？怎么回事哦？",{"我不小心弄坏了入学测试的人格测试机",-5,0},{"人格测试机太差劲了，被我弄坏了",5,0}},
	[5] = {"那个嘛哈哈！本来就是欺负新生的，不过你要对测试结果保密哦",{"哈？竟然这样！？保密？为什么？",0,0}},
	[6] = {"据说是曾经有人把测试结果告诉别人后没有交到朋友，并且被当成了混混。这种测试也挺无聊的，那个你还没去过学校吧？",{"是啊，正准备去，就遇到了先辈",3,3}},
	[7] = {"哈哈！真是太巧，这样的话让我当你向导吧，你还不熟悉学校周围吧！",{"太好了！非常感谢",4,4}},
	[8] = {"没什么啦，遇到一年级新生让我特别开心呢！你有什么能力？",{"我……我是lvl1的水流控制……",0,0}},
	[9] = {"lvl1!?低……低能力者！？",{"果然是嫌我能力太弱了吗？",3,0},{"",,}}

	before = "\27[37m（终于摆脱了那个混混,你大嘘一口气，没想到来学院都市第一天就遇到了这样麻烦的事！接下来要去学校报到吧，在手册中看看栅川中学的位置：栅川中学位于学园都市第七学区，处于第七学区的中心位置，因此也是风纪委员177支部所在……，离这儿不是很远，走过去应该只要20分钟，顺便还可以熟悉下学校周围的环境，就在这时你听到……）\27[0m\n",
	pass = "11",
	fight ="就算你夸我也没有好处哦",
}
inschool.story.func = function (academy_t)
	return true
end

inschool.monster={name = "佐天泪子",hp = 1000,_skill={},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
inschool.monster.think = commonthink
inschool.exp = 8
inschool.loot = {}
--就算你夸我也没有好处哦






return level
