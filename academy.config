local level = {}
--[[关卡结构,每一关有有2个表:stroy和monster,其中stroy中是所有剧情,stroycon是每对话一次都会调用的函数来判断玩家是否可以进行下一步对话]]
--[[monster是Monter的属性表和技能名，和AI状态机函数【如果lua语法错load则会提示lua:37: attempt to call a nil value】]]
--[[exp是通过该关卡获得的经验]]

local function commonthink(academy_t)
	local self = academy_t
	local monster = self.monster
	local role = self.role
	local skill_num = #monster.skill
	local skill_index
	repeat
		skill_index = math.random(skill_num)
	until not (monster.skill[skill_index].passive)
	monster:castskill(monster.skill[skill_index].name,role)
	--monster:castskill(monster.skill[math.random(skill_num)].name,role)
end

function commonrule(academy_t)
	local self = academy_t
	local monster = self.monster
	local role = self.role
	if self.role.law <1 then
		return false
	end
	return true
end

--第一关校外打流氓(混混喜欢秩序低于-50友好>10的角色)
local outschool ={}
level[1] = outschool
outschool.name = "不期而遇的麻烦!"
outschool.story = {
	[1] = {"嘿!?那边那个你在干吗呢?嘿嘿!",{"我……",0,1},{"不关你事吧!",1,-1}},
	[2] = {"嘿嘿!学园都市的学生是吗?",{"额……不是……",3,0},{"(无视他……)",-3,-3}},
	[3] = {"soga……觉得你蛮有趣呢!",{"够了吧，我不想再和你说话。",5,-2},{"真是无聊，你要干什么呢？",-5,2}},
	[4] = {"你刚才干嘛了？我好像听到了警报声啊！",{"那一定是你听错了，我可没听到什么声音！",-5,0}},
	[5] = {"是吗？不会是你干了什么坏事吧？！",{"坏事是只有你这种人才会干的吧！",3,-2},{"人格测试那种东西坏掉才好呢！",-3,2}},
	before = "(这是你第一次进入学院都市，并且一时冲动弄坏了人格测试机，虽然是收到学院都市栅川中学的入学邀请，但对于自己这样莽撞的行为心里还是很慌……)",
	pass = "诶！那种东西早该坏掉了！！就是因为它我才被大家当成了混混！/(ㄒoㄒ)/~~",
	fight = "看来跟你讲\"道理\"是很难的一件事呢！",
	}
outschool.story.func=function (academy_t)
	-- 这个函数能获取当前academy_t的所有域值
	local self = academy_t
	local monster = self.monster
	local role = self.role
	if self.role.law < -50 and self.role.good >10 then 
		return true
	end 
	return false
end
--{level=0,exp=0,hp=200,mp=50,natt=20,ndef=0,sdef=0,bpos=0,bspd=0,accu=0,miss=0,crit=0,skill={},buffround={},name ="name",law=0,good=0}
outschool.monster = {name="街头混混",_skill={"强力击","操纵火焰"},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
outschool.monster.think = commonthink
outschool.exp = 6
outschool.loot = {{5000,"强力击"},{5000,"操纵火焰"}}  --掉落之类的，可能目前只会从monster._skill表中掉技能。。

--第二关 遇见佐天泪子，与之对话，纠正世界观。（佐天泪子会和你说完所有的对话）
local inschool = {}
level[2] = inschool
inschool.name = "素不相识的伙伴!"
inschool.story = {
	[1] = {"\'栅川中学入学指南\'？……新生？哇！一年级的新生？",{"……",0,0}},
	[2] = {"那个？你是栅川一年级的新生吗？叫什么名字呢？",{"先辈？我叫平泽唯",3,3}},
	[3] = {"先辈！？好…好…厉害！！我是佐天泪子，你是今天才来学院都市吗？",{"是啊，第一天来就遇到了麻烦事",0,2}},
	[4] = {"诶！？麻烦？怎么回事哦？",{"我不小心弄坏了入学测试的人格测试机",-5,0},{"人格测试机太差劲了，被我弄坏了",5,0}},
	[5] = {"那个嘛哈哈！本来就是欺负新生的，不过你要对测试结果保密哦",{"哈？竟然这样！？保密？为什么？",0,0}},
	[6] = {"据说是曾经有人把测试结果告诉别人后没有交到朋友，并且被当成了混混。这种测试也挺无聊的，那个你还没去过学校吧？",{"是啊，正准备去，就遇到了先辈",3,3}},
	[7] = {"哈哈！真是太巧，这样的话让我当你向导吧，你还不熟悉学校周围吧！",{"太好了！非常感谢",4,4}},
	[8] = {"没什么啦，遇到一年级新生让我特别开心呢！你有什么能力？",{"我……我是lvl1的意念之光……",0,0}},
	[9] = {"lvl1!?低！……低能力者！？",{"果然是我能力太弱了吗？",3,0}},
	[10] = {"哪里哪里，新生都是lvl1真是太厉害了，我还是lvl0呢！",{"诶？lvl0?",0,3},{"不要介意啦！",0,-3}},
	[11] = {"没关系哦！其实lvl0有时候意外的有用呢！",{"真的吗？",0,3},{"这样真是太好了",0,-3}},
	[12] = {"是啊，有lvl5来保护大家就可以了，另外还有警备员呢！",{"原来，超能力也不是那么重要",5,0},{"希望我以后也能保护大家",0,-5}},
	[13] = {"恩！不过你也要多努力才行，总之，努力不会有错的",{"我记住了！",5,5}},


	before = "(终于摆脱了那个混混,你大嘘一口气，没想到来学院都市第一天就遇到了这样麻烦的事！接下来要去学校报到吧，在手册中看看栅川中学的位置：栅川中学位于学园都市第七学区，处于第七学区的中心位置，因此也是风纪委员177支部所在……，离这儿不是很远，走过去应该只要20分钟，顺便还可以熟悉下学校周围的环境，就在这时你听到……)",
	pass = "呀呀！说着说着就到学校了，那再见吧，如果遇到什么问题，可不要忘记来找我哦",
	fight ="就算你夸我也没有好处哦",
}
inschool.story.func = function (academy_t)
	return true
end

inschool.monster={name = "佐天泪子",hp = 1000,_skill={},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
inschool.monster.think = commonthink
inschool.exp = 8
inschool.loot = {{10000,"意念之光"}}

--第三关
local miswater = {}
level[3] = miswater
miswater.name = "被误解的水!"
miswater.story={ --黑科技:移动光标去掉姓名
	[1] = {"\27[8D\27[K(游泳池的观众椅上坐着不少同学，游泳池边上也站着一些同学，都在观看正在进行的测试,你也被当前进行测试的同学吸引了，向游泳池看去……",{"(继续……)",0,0}}, 
	[2] = {"\27[8D\27[K(一个游泳池的水全部凝结成冰，游泳池的另一边站着一位蓝色头发的女生，然后她走到了游泳池里面，伸出右手，在冰面上轻轻一抚，砰——!,突然冰面上冒出4个冰锥……)",{"(继续……)",0,0}},
	[3] = {"\27[8D\27[K某老师:能力值180，lvl4冰力使……",{"(原来她就是栅川超能力第一的冰力使-风间惠子……)",0,0}},
	[4] = {"\27[8D\27[K??:呵呵~！连续2年都是lvl4吗？真是没长进的\'废物！\'",{"这……这位同学，这样可不对哦！",0,3},{"(假装没听到……)",0,-3}},
	[5] = {"我说那边那个，看你这样，肯定是新来的\'废物\'吧？！",{"\'废物\'这种名称丢给你自己好了！",3,-1},{"咦？",0,3}},
	[6] = {"我可是lvl1的风力使哦？",{"果然\'废物\'很适合你呢！",-3,-5},{"果然和我一样呢！",0,3}},
	[7] = {"我可不是和你一样的\'废物\',要不来\'比试一下\'？",{"学校里可不允许打架,再见啦！",5,0},{"好啊，你可一定不要求饶！",-5,0}},
	
	before = "(已经入学几天了，今天正在进行能力测试，原来栅川大约有一半的人都是lvl0，经过基本的测试后，你来到了学校游泳池，这里是进行能力值测试的地方……)",
	pass = "哈哈！胆小鬼，真是没用！",
	fight = "一会求饶的是你吧!",
}
miswater.story.func = function (academy_t)
	if academy_t.role.curstoryid==7 and academy_t.role.lastchoice ==2 then 
		return false
	end
	return true
end
miswater.monster={name = "新木村",hp = 1000,_skill={},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
miswater.monster.think = commonthink
miswater.exp = 10
miswater.loot = {}

--第四关 				//前面环境铺垫好了，主线从lvlupper 开始 ->上当被骗使用lvlupper ->把levelupper送给佐天泪子->超强潜力被激发,能力暴涨 -> 被坏人利用做坏事 ->被打败后醒悟,回归正轨 -> 找出幕后黑手并击败
local lostsky = {}	
level[4] = lostsky
lostsky.name = "失落的天空!"
lostsky.story = {
	[1] = {"\27[10D\27[K??:呐！不想让我动手吧！快把东西交出来！",{"（顺着声音走过去...）",0,0}},
	[2] = {"\27[10D\27[K(在街边，一个高大的男子将一个女生堵在墙角，女生一头短发凌乱地飘散在空气中……）",{"住手！不要欺负女生！",0,0},},
	[3] = {"哼！劝你不要多管闲事！",{"呐！那边的你还好吧？不要怕！",0,0}},
	[4] = {"\27[10D\27[K(你对着女生大喊，透过片乱的头发，你看到的她的眼睛，那是悲伤……忽然，一道强光从她胸前射到了男子眼睛，亮光中你看到了她苍白的脸颊，一个黑色的方块从空中飞了过来，你本能的伸出手接住了……，是MP3播放器，耳机也缠在上面……，男子已回过神来,将她甩倒在墙角……)",{"(继续……）",0,0}},
	[5] = {"东西还给我！（他向你冲了过来）",{"快跑！女生大声喊道……",0,0}},
	[6] = {"\27[10D\27[K(你看了倒在墙边的她一眼，接着转身就跑进了街边的小巷，天已经黑了，只能凭方向朝学校跑去，男子在后面紧追不舍……)",{"用尽全力奔跑……",0,0}},
	[7] = {"\27[10D\27[K(穿过一个一个的巷子，险些被抓到，可是双腿已变得沉重，快要跑不动了,跑到前面街口就能看到学校了吧……,突然脚下一绊，你摔倒了……)",{"(继续……)",0,0}},
	[8] = {"唷！你还挺能跑的！东西交出来，不然我又要\'欺负\'女生了哦！",{"(要是再坚持一下跑到学校就好了)",5,0},{"(要是有人从这里经过就好了)",0,5}},
	[9] = {"\27[10D\27[K(你从口袋里拿出了MP3播放器，上面的音乐还在播放，你带上耳机……刹那间，你感到头晕目眩，世界旋转了起来，身体在发热，眼睛在燃烧，在灼热的目光中你看到了男子颤抖的身影，然后失去了意识，只有奇怪的声音在脑海里回想……",{"(继续……)",0,0}},
	[10] = {"\27[10D\27[K(过了不久，你逐渐恢复了意识，耳边的音乐还在播放，不，那不是音乐，那是奇怪的\'噪音\'，神经随着那\'噪音\'砰砰地跳冻着，浑身火热，你摘掉耳机睁开眼睛，看到周围弥漫着奇怪的光场，自己周围的光竟然被不规则地扭曲了，刚才追你的男子瘫倒在远处，不知道怎么回事，显然他也晕倒了……）",{"(走过去叫醒他……)",0,3},{"(趁现在先回学校吧……)",3,0}},
    [11] = {"\27[10D\27[K(这时男子却自己醒了过了，并摇晃着站了起来……他显然已毫无威胁）",{"（继续……）",0,0}},
    [12] = {"没想到levelupper会对你起这么大作用？！",{"levelupper？那是什么？",0,0}},
    [13] = {"既然你都使用它了，那告诉你也没关心了，levelupper就是幻想御手，学院都市低能者之间暗中传播的提升能力的音乐程序，或许你还还没有意识到这里的黑暗吧，低能者被歧视，只有那些高能力者才享有光明",{"这就是现实吗？",-3,0},{"我不相信你说的",0,3}},
	[14] = {"不管你是否相信，这都是我的现实，不然我也不会费尽心思得到levelupper，还有那个女孩……",{"这又是怎么一回事?还有那女孩?你为什么要欺负她?",0,0}},
	[15] = {"因为她偷走了我的levelupper，虽然我用了很久levelupper都没有能力提升，但是不允许它被别人拿走",{"这么说levelupper是你的?",0,0}},
	[16] = {"levelupper是我花大价钱从黑市上买到的，那女生是我同班的lvl1，不知道什么时候就被她拿走了，对她也好像没什么效果吧，也是可怜……",{"(继续...)",0,0}},
	[17] = {"不过levelupper却对你有这么强烈的作用，真是意外，当时看你被奇怪的光芒吞噬，可是当真让人害怕",{"被奇怪的光吞噬?",0,0}},
	[18] = {"是啊，被奇异的光芒包围着，还有黑暗，你的能力应该与光有关吧？",{"不久前测试是lvl1的念力之光",0,0}},
	[19] = {"lvl1?恐怕你现在已不是lvl1了吧",{"(你尝试使用念力之光,果然控制光的能力比以前强了很多,控制自己反射的光，你看到自己的身体消失在了空间中……你恢复了正常)",0,0}},
	[20] = {"凭空消失?!",{"只是控制自己周围的光场……",0,0}},
	[21] = {"光……光明么？！(他面露悲伤)",{"既然levelupper是你的，这个还给你吧",0,0}},
	[22] = {"不用了,levelupper对我没用吧！你带着它吧，希望你变得更强",{"这……不是你花钱买的吗？",0,0}},
	[23] = {"我买的又有什么用呢……如果可以的话，我到希望你能帮我一个忙？",{"唔……不是坏事的话我可以帮你",0,0}},
	[24] = {"好吧！其实也是对你有作用的，levelupper虽然很强大，但是同样存在副作用",{"副作用？",0,0}},
	[25] = {"长期使用有可能导致一睡不醒，失去自我……,所以期望你能够拿到程序源代码来重新构建消除副作用……",{"要在谁那里才能拿到程序源代码呢？",0,0}},
	[26] = {"levelupper虽然是从黑市上流传开来的，但是这种高科技的东西只有在学院都市超能力研究院才能研究出来，不过这仅猜测，下一步的调查就交给你了",{"诶？",0,0}},
	before = "（能力测试终于结束了，真是烦人的一天，\'能力值103，lvl1\'，明明以为自己突破到lvl2，可还是lvl1，要怎么努力呢，太烦人了……，天都暗了下来，你一个人仍在学校外边的街道上晃悠着，能力测试的结果还在耳边徘徊，这时街边的小巷中传来了声音……)",
	pass = "对了！你也不要使用levelupper了，至少再拿到源代码之前停止使用吧！",
	fight = "",	
}
lostsky.story.func =function (academy_t)
		return true 
end
lostsky.monster={name = "石川中村",hp = 1000,_skill={},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
lostsky.monster.think = commonthink
lostsky.exp = 10
lostsky.loot = {{10000,"聚合光束"},{10000,"奇异光芒"},{10000,"光之耀"},{10000,"穿透光束"},{10000,"光之匿"}}

--第五关
local lightshine = {}
level[5] = lightshine
lightshine.name = "开始跃动的光!"
lightshine.story = {
	[1] = {"\27[10D\27[K(在查完宿舍后，你利用超能力偷偷溜出了学校，来到了AIM解析研究所外边，研究所还有几个房间依然亮着灯，难道还有人在里面？)",{"（继续……）",0,0}},
	[2] = {"\27[10D\27[K(你从围墙上溜了进去，似乎并没有引起异动，并且使用了光之匿后应该没人看的到才对……)",{"（继续……）",0,0}},
	[3] = {"\27[10D\27[K(整个研究院都很安静，虽然有一些摄像头，但光之匿可以轻易弯曲任何光线，这样即使是红外摄像头也不会发现你)",{"（继续……）",0,0}},
	[4] = {"\27[10D\27[K(确认安全后你径直向研究楼走去，突然你听到什么破空飞来的声音！！……)",{"（迅速躲开……）",0,0}},
	before = "(在你开始调查levelupper事件3个月后,终于找到了一些线索，在经过几天的排查后，最终发现AIM解析研究所做的研究最有可能和levelupper有关，你决定今晚潜入那里看看……)",
	pass = "",
	fight = "笨蛋!你踩到草丛了……",
}
lightshine.story.func =function (academy_t)
		return false 
end
lightshine.monster={name = "高坂友树",hp = 1000,_skill={"空气炮"},_superskill = {},hp=30,mp=9999,natt=12,ndef=0,satt=0,sdef=0,bpos=0,bspd=10,accu=0,miss=0,crit=0}
lightshine.monster.think = commonthink
lightshine.exp = 10
lightshine.loot = {}



--这可不是夸你哦
--才没有夸你哦
--我一直把你当做对手哦
--就算你夸我也没有好处哦
--就算你这样说我也不会夸你哦
--你这是在夸我咯
--哈哈你竟然这样夸我
--





return level
